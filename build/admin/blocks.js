!function(){"use strict";var t={n:function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,{a:r}),r},d:function(e,r){for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}},e=window.wp.apiFetch,r=t.n(e);window.wp.url;const n=async(t,e)=>{const{openai_key:r}=e;try{const e=await(async t=>{try{const e=await fetch(t),r=await e.blob();return new Promise(((t,e)=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.onerror=e,n.readAsDataURL(r)}))}catch(t){throw console.error("Error converting image to base64:",t),t}})(t),n="Create a SEO optimized alt text for this image. Don't include quotes and keep it informative and concise.",o=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({model:"gpt-4-vision-preview",messages:[{role:"user",content:[{type:"text",text:n},{type:"image_url",image_url:{url:e}}]}]})});return(await o.json()).choices[0].message.content}catch(t){throw console.error("Error generating alt text:",t),t}};var o=window.ReactJSXRuntime;const{createHigherOrderComponent:a}=wp.compose,{Fragment:i,useState:s,useEffect:c}=wp.element,{PanelBody:l,Button:p}=wp.components,{InspectorControls:u}=wp.blockEditor,d=({BlockEdit:t,props:e})=>{const[a,d]=s({}),[g,h]=s("");return c((()=>{(async()=>{try{const t=await(async()=>{try{const t=await r()({path:"wp/v2/settings",method:"GET"});return t&&t.aatg_text_generator_options?t.aatg_text_generator_options:t}catch(t){return console.error("fetchSettings Errors:",t),{ai_alt_text_generator_options_fetch_settings_errors:!0}}})();d(t)}catch(t){console.error("Error fetching settings:",t)}})()}),[]),(0,o.jsxs)(i,{children:[(0,o.jsx)(t,{...e}),"core/image"===e.name&&(0,o.jsx)(u,{children:(0,o.jsxs)(l,{title:"Generate Alt Text",children:[(0,o.jsx)(p,{isSecondary:!0,onClick:async()=>{const{attributes:t,setAttributes:r}=e,{url:o}=t;h("Generating alt text...");try{r({alt:await n(o,a)}),h("Alt text generated successfully!")}catch(t){console.error("Error generating alt text:",t),h("Error generating alt text.")}},children:"Generate Alt Text"}),g&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),(0,o.jsx)("p",{children:g})]})]})})]})},g=a((t=>e=>(0,o.jsx)(d,{BlockEdit:t,props:e})),"withGenerateAltTextButton");wp.hooks.addFilter("editor.BlockEdit","ai-alt-text-generator/with-generate-alt-text-button",g)}();